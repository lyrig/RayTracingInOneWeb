(()=>{"use strict";var e={493:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.camera=void 0;var r=n(609),o=n(569),i=n(104),u=function(){function e(e,t,n,i,u,a,c){void 0===u&&(u=16/9),this.u=new o.vec3,this.v=new o.vec3,this.w=new o.vec3;var s=u,l=r.degrees_to_radians(i),d=2*Math.tan(l/2),h=s*d;this.w.copy(o.unit_vector(o.minus(e,t))),this.u.copy(o.unit_vector(o.cross(n,this.w))),this.v.copy(o.cross(this.w,this.u)),this.origin=new o.vec3,this.origin.copy(e),this.horizontal=new o.vec3,this.horizontal.copy(o.mul(this.u,h).mul(c)),this.vertical=new o.vec3,this.vertical.copy(o.mul(this.v,d).mul(c)),this.lower_left_corner=o.minus(this.origin,o.div(this.horizontal,2)).minus(o.div(this.vertical,2)).minus(o.mul(this.w,c)),this.lens_radius=a/2}return e.prototype.get_ray=function(e,t){var n=new o.vec3;n.copy(o.mul(o.random_in_unit_disk(),this.lens_radius));var r=new o.vec3;return r.copy(o.add(o.mul(this.u,n.x),o.mul(this.v,n.y))),new i.ray(o.add(this.origin,r),o.add(this.lower_left_corner,o.mul(this.horizontal,e)).add(o.mul(this.vertical,t)).minus(this.origin).minus(r))},e}();t.camera=u},75:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.write_color=void 0;var r=n(609);t.write_color=function(e,t,n,o,i,u,a){var c=4*(n*o+t),s=u.x,l=u.y,d=u.z,h=1/a;s*=h,l*=h,d*=h,s=Math.sqrt(s),l=Math.sqrt(l),d=Math.sqrt(d),e.data[c]=255*r.clamp(s,0,.999),e.data[c+1]=255*r.clamp(l,0,.999),e.data[c+2]=255*r.clamp(d,0,.999),e.data[c+3]=255}},397:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hittable=t.hit_record=void 0;var r=n(569),o=function(){function e(){this.p=new r.vec3([0,0,0]),this.normal=new r.vec3([0,0,0]),this.t=0,this.front_face=!0}return e.prototype.set_face_normal=function(e,t){this.front_face=r.dot(e.direction,t)<0,this.normal=this.front_face?t:new r.vec3(t).negtive()},e.prototype.copy=function(e){this.p=e.p,this.normal=e.normal,this.t=e.t,this.front_face=e.front_face,this.mat_ptr=e.mat_ptr},e}();t.hit_record=o;t.hittable=function(){}},196:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.hittable_list=void 0;var i=n(397),u=n(747),a=function(e){function t(t){var n=e.call(this)||this;return null==t?n.objects=new Array:t instanceof u.Sphere&&(n.objects=new Array,n.objects.push(t)),n}return o(t,e),t.prototype.clear=function(){this.objects.length=0},t.prototype.add=function(e){this.objects.push(e)},t.prototype.hit=function(e,t,n,r){for(var o=new i.hit_record,u=!1,a=n,c=0,s=this.objects;c<s.length;c++)s[c].hit(e,t,a,o)&&(u=!0,a=o.t,r.copy(o));return u},t}(i.hittable);t.hittable_list=a},435:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.dielectric=t.metal=t.lambertian=t.material=void 0;var i=n(569),u=n(569),a=n(104),c=function(){};t.material=c;var s=function(e){function t(t){var n=e.call(this)||this;return n.albedo=new i.vec3,n.albedo.copy(t),n}return o(t,e),t.prototype.scatter=function(e,t,n,r){var o=u.add(t.normal,u.random_unit_vector());return o.near_zero()&&(o=t.normal),r.copy(new a.ray(t.p,o)),n.copy(this.albedo),!0},t}(c);t.lambertian=s;var l=function(e){function t(t,n){var r=e.call(this)||this;return r.albedo=new i.vec3,r.albedo.copy(t),r.fuzz=n<1?n:1,r}return o(t,e),t.prototype.scatter=function(e,t,n,r){var o=u.reflect(u.unit_vector(e.direction),t.normal);return r.copy(new a.ray(t.p,u.add(o,u.random_in_unit_sphere().mul(this.fuzz)))),n.copy(this.albedo),u.dot(r.direction,t.normal)>0},t}(c);t.metal=l;var d=function(e){function t(t){var n=e.call(this)||this;return n.ir=t,n}return o(t,e),t.prototype.scatter=function(e,t,n,r){n.copy(new u.vec3([1,1,1]));var o=t.front_face?1/this.ir:this.ir,i=u.unit_vector(e.direction),c=Math.min(u.dot(i.negtive(),t.normal),1),s=o*Math.sqrt(1-c*c)>1,l=new u.vec3;return s||this.reflectance(c,o)>Math.random()?l.copy(u.reflect(i,t.normal)):l.copy(u.refract(i,t.normal,o)),r.copy(new a.ray(t.p,l)),!0},t.prototype.reflectance=function(e,t){var n=(1-t)/(1+t);return(n*=n)+(1-n)*Math.pow(1-e,5)},t}(c);t.dielectric=d},609:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=t.random_double=t.degrees_to_radians=t.pi=t[1/0]=void 0,t[1/0]=1e30,t.pi=3.141592653589793,t.degrees_to_radians=function(e){return e*t.pi/180},t.random_double=function(e,t){return void 0===typeof e||null==e||null==typeof t||null==t?Math.random():Math.random()*(t-e)+e},t.clamp=function(e,t,n){return e<t?t:e>n?n:e}},104:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ray=void 0;var r=n(569),o=function(){function e(e,t){if(void 0===e||void 0===t)this.orig=new r.vec3([0,0,0]),this.dir=new r.vec3([0,0,0]);else{if(!(e instanceof r.vec3&&t instanceof r.vec3))throw new Error("ray: Invalid arguments");this.orig=new r.vec3(e),this.dir=new r.vec3(t)}}return Object.defineProperty(e.prototype,"origin",{get:function(){return this.orig},set:function(e){this.orig=new r.vec3(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this.dir},set:function(e){this.dir=new r.vec3(e)},enumerable:!1,configurable:!0}),e.prototype.at=function(e){return r.add(this.orig,r.mul(this.dir,e))},e.prototype.copy=function(e){this.orig=e.orig,this.dir=e.dir},e}();t.ray=o},747:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.hit=t.Sphere=void 0;var i=n(397),u=n(569),a=function(e){function t(t,n,r){var o=e.call(this)||this;return null==typeof t||null==typeof n||null==typeof r||null==t||null==n||null==r?(o.center=new u.vec3([0,0,0]),o.radius=1,console.log("m problem")):(o.center=new u.vec3(t),o.radius=n,o.mat_ptr=r),o}return o(t,e),t.prototype.hit=function(e,t,n,r){var o=u.minus(e.origin,this.center),i=e.direction.length_squared(),a=u.dot(o,e.direction),c=a*a-i*(o.length_squared()-this.radius*this.radius);if(c<0)return!1;var s=Math.sqrt(c),l=(-a-s)/i;if((l<t||n<l)&&((l=(-a+s)/i)<t||n<l))return!1;r.t=l,r.p=e.at(r.t);var d=u.div(u.minus(r.p,this.center),this.radius);return r.set_face_normal(e,d),r.mat_ptr=this.mat_ptr,!0},t}(i.hittable);t.Sphere=a,t.hit=function(e){e.normal=new u.vec3([2,2,2])}},569:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.random_in_unit_disk=t.refract=t.reflect=t.copy=t.random_in_hemisphere=t.random_unit_vector=t.random_in_unit_sphere=t.random=t.unit_vector=t.cross=t.dot=t.div=t.mul=t.negtive=t.minus=t.add=t.vec3=void 0;var r=n(609),o=function(){function e(t){this.e=[],void 0===t?this.e.push(0,0,0):t instanceof e?this.e.push(t.x,t.y,t.z):t instanceof Array&&3===t.length?this.e=t:console.log("No value provided")}return Object.defineProperty(e.prototype,"x",{get:function(){return this.e[0]},set:function(e){this.e[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.e[1]},set:function(e){this.e[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.e[2]},set:function(e){this.e[2]=e},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.e[e]},e.prototype.set=function(e,t){this.e[e]=t},e.prototype.add=function(e){return this.e[0]+=e.e[0],this.e[1]+=e.e[1],this.e[2]+=e.e[2],this},e.prototype.minus=function(e){return this.e[0]-=e.e[0],this.e[1]-=e.e[1],this.e[2]-=e.e[2],this},e.prototype.negtive=function(){return this.e[0]=-this.e[0],this.e[1]=-this.e[1],this.e[2]=-this.e[2],this},e.prototype.mul=function(e){return this.e[0]*=e,this.e[1]*=e,this.e[2]*=e,this},e.prototype.div=function(e){return this.mul(1/e)},e.prototype.length=function(){return Math.sqrt(this.e[0]*this.e[0]+this.e[1]*this.e[1]+this.e[2]*this.e[2])},e.prototype.length_squared=function(){return this.e[0]*this.e[0]+this.e[1]*this.e[1]+this.e[2]*this.e[2]},e.prototype.copy=function(e){this.e[0]=e.e[0],this.e[1]=e.e[1],this.e[2]=e.e[2]},e.prototype.near_zero=function(){var e=1e-8;return Math.abs(this.e[0])<e&&Math.abs(this.e[1])<e&&Math.abs(this.e[2])<e},e}();function i(e,t){return new o(e).add(t)}function u(e,t){return new o(e).minus(t)}function a(e,t){if("number"==typeof t)return new o(e).mul(t);if(t instanceof o)return new o([e.x*t.x,e.y*t.y,e.z*t.z]);throw new Error("Invalid parameter")}function c(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function s(e){return new o(e).div(e.length())}function l(e,t){return new o(void 0===typeof e||null==e||null==t||null==typeof t?[r.random_double(),r.random_double(),r.random_double()]:[r.random_double(e,t),r.random_double(e,t),r.random_double(e,t)])}function d(){for(;;){var e=l(-1,1);if(!(e.length_squared()>=1))return e}}t.vec3=o,t.add=i,t.minus=u,t.negtive=function(e){return new o(e).negtive()},t.mul=a,t.div=function(e,t){return new o(e).div(t)},t.dot=c,t.cross=function(e,t){return new o([e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x])},t.unit_vector=s,t.random=l,t.random_in_unit_sphere=d,t.random_unit_vector=function(){return s(d())},t.random_in_hemisphere=function(e){var t=d();return c(t,e)>0?t:t.negtive()},t.copy=function(e,t){e.copy(t)},t.reflect=function(e,t){return u(e,a(t,c(e,t)).mul(2))},t.refract=function(e,t,n){var r=Math.min(c(e.negtive(),t),1),o=i(e,a(t,r)).mul(n);return i(a(t,-Math.sqrt(Math.abs(1-o.length_squared()))),o)},t.random_in_unit_disk=function(){for(;;){var e=new o([r.random_double(-1,1),r.random_double(-1,1),0]);if(!(e.length_squared()>=1))return e}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(()=>{var e=n(569),t=n(75),r=n(104),o=n(196),i=n(397),u=n(609),a=n(747),c=n(493),s=n(435);function l(t,n,o){if(o<=0)return new e.vec3([0,0,0]);var a=new i.hit_record;if(n.hit(t,1e-4,u.Infinity,a)){var c=new r.ray,s=new e.vec3;return a.mat_ptr.scatter(t,a,s,c)?e.mul(s,l(c,n,o-1)):new e.vec3}var d=.5*(e.unit_vector(t.direction).y+1);return new e.vec3([1,1,1]).mul(1-d).add(new e.vec3([.5,.7,1]).mul(d))}document.addEventListener("DOMContentLoaded",(function(){var n=document.getElementById("MainCanvas"),r=n.getContext("2d"),i=n.width,d=n.height,h=i*d;null!=r&&null!=typeof r||window.close();var f=r.createImageData(i,d),p=i/d,v=i,m=d,y=document.getElementById("Progress"),_=100,w=50,b=new e.vec3([13,2,3]),g=new e.vec3([0,0,0]),E=new e.vec3([0,1,0]),x=10,M=.1,O=0;function j(){y.value=0,y.textContent=y.value.toString()+"%";var j=0;if(r){r.fillStyle="#FFFFFF",r.fillRect(0,0,n.width,n.height);var I=new o.hittable_list;!function(t,n){void 0===n&&(n=11);var r=new s.lambertian(new e.vec3([.5,.5,.5]));t.add(new a.Sphere(new e.vec3([0,-1e3,0]),1e3,r));for(var o=-n;o<n;o++)for(var i=-n;i<n;i++){var c=u.random_double(),l=new e.vec3([o+.9*u.random_double(),.2,i+.9*u.random_double()]);if(e.minus(l,new e.vec3([4,.2,0])).length()>.9)if(c<.8){var d=e.mul(e.random(),e.random()),h=new s.lambertian(d);t.add(new a.Sphere(l,.2,h))}else if(c<.95){d=e.random(.5,1);var f=u.random_double(0,.5);h=new s.metal(d,f),t.add(new a.Sphere(l,.2,h))}else h=new s.dielectric(1.5),t.add(new a.Sphere(l,.2,h))}var p=new s.dielectric(1.5);t.add(new a.Sphere(new e.vec3([0,1,0]),1,p));var v=new s.lambertian(new e.vec3([.4,.2,.1]));t.add(new a.Sphere(new e.vec3([-4,1,0]),1,v));var m=new s.metal(new e.vec3([.7,.6,.5]),0);t.add(new a.Sphere(new e.vec3([4,1,0]),1,m))}(I,O);for(var z=new c.camera(b,g,E,20,p,M,x),B=function(n){for(var o=function(o){setTimeout((function(){return function(n,o,a,c){for(var s=new e.vec3([0,0,0]),h=0;h<_;h+=1){var p=(n+u.random_double())/(v-1),y=(o+u.random_double())/(m-1),b=a.get_ray(p,y);s.add(l(b,c,w))}t.write_color(f,n,d-o-1,i,d,s,_),r.putImageData(f,0,0),j+=1}(o,n,z,I)}),.1*(o+(d-n-1)*i)),setTimeout((function(){y.value=j/h*100,y.textContent=y.value.toFixed(3).toString()+"%"}),.1*(o+(d-n-1)*i))},a=0;a<i;a+=1)o(a)},S=d-1;S>=0;S-=1)B(S)}}console.log("YEYYYSYSYSYSYS"),j();var I=document.getElementById("Upbtn"),z=document.getElementById("Downbtn"),B=document.getElementById("Leftbtn"),S=document.getElementById("Rightbtn"),P=document.getElementById("Frontbtn"),L=document.getElementById("Backbtn"),q=document.getElementById("valueDisplay"),C=document.getElementById("stepsize"),N=document.getElementById("DisplaySample"),D=document.getElementById("sample_per_pixel"),k=document.getElementById("DisplayDepth"),A=document.getElementById("max_dpeth"),F=document.getElementById("DisplayDtf"),Y=document.getElementById("dist_to_focus"),T=document.getElementById("DisplayApe"),R=document.getElementById("aperture"),U=document.getElementById("DisplayNum"),G=document.getElementById("num_generate"),H=document.getElementById("Activate");I&&I.addEventListener("click",(function(){b.e[1]+=Number(C.value),j()})),z.addEventListener("click",(function(){b.e[1]-=Number(C.value),j()})),B.addEventListener("click",(function(){b.e[0]-=Number(C.value),j()})),S.addEventListener("click",(function(){b.e[0]+=Number(C.value),j()})),P.addEventListener("click",(function(){b.e[2]+=Number(C.value),j()})),L.addEventListener("click",(function(){b.e[2]+=Number(C.value),j()})),H.addEventListener("click",(function(){_=Number(D.value),w=Number(A.value),x=Number(Y.value),M=Number(R.value),O=Math.ceil(Math.sqrt(Math.sqrt(Number(G.value)))),j()})),C.addEventListener("input",(function(){q.textContent=C.value})),D.addEventListener("input",(function(){N.textContent="采样数: "+D.value})),A.addEventListener("input",(function(){k.textContent="光线反射深度: "+A.value})),Y.addEventListener("input",(function(){F.textContent="焦距: "+Y.value})),R.addEventListener("input",(function(){T.textContent="光圈孔径: "+R.value})),G.addEventListener("input",(function(){U.textContent="物体数目（不一定准）: "+G.value}))}))})()})();